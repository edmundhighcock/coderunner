sudo: false
language: ruby
rvm:
  - 2.2.0
notifications:
    email:
        on_success: change
        on_failure: change

addons:
    apt:
        packages:
        - subversion
        - gsl-bin
        - libgsl0-dev

before_install:
    - svn co svn://svn.code.sf.net/p/coderunner/svn/installer_new coderunner_svn
    - cd coderunner_svn && make hd all PREFIX=$HOME/tools
    - echo "export PATH=$HOME/tools/bin:$PATH" >> $HOME/.bashrc
    - wget ftp://ftp.gnu.org/gnu/gsl/gsl-1.16.tar.gz
    - tar -xf gsl-1.16.tar.gz && cd gsl-1.16 && ./configure --prefix=$HOME/gsl116 &&
      make && make install
    - echo "export PATH=$HOME/gsl116/bin:$PATH" >> $HOME/.bashrc

install:
    - bundle install
    - rake build; gem install -l pkg/coderunner*.gem
    - mkdir -m 700 -p -v $HOME/.ssh
    - ssh-keygen -t rsa -N '' -f $HOME/.ssh/id_rsa
    - cat $HOME/.ssh/id_rsa.pub > $HOME/.ssh/authorized_keys
    - cat $HOME/.ssh/id_rsa.pub > $HOME/.ssh/known_hosts
    - echo "Host *" >> $HOME/.ssh/config &&
      echo "  NoHostAuthenticationForLocalhost yes" >> $HOME/.ssh/config
    - echo "export CODE_RUNNER_SYSTEM=generic_linux" > $HOME/.bashrc

script:
    - export CPP=g++ && rake test
